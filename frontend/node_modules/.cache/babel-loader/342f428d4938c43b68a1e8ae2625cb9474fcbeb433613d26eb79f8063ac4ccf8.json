{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  MutableRequestCookiesAdapter: null,\n  ReadonlyRequestCookiesError: null,\n  RequestCookiesAdapter: null,\n  appendMutableCookies: null,\n  getModifiedCookieValues: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  MutableRequestCookiesAdapter: function () {\n    return MutableRequestCookiesAdapter;\n  },\n  ReadonlyRequestCookiesError: function () {\n    return ReadonlyRequestCookiesError;\n  },\n  RequestCookiesAdapter: function () {\n    return RequestCookiesAdapter;\n  },\n  appendMutableCookies: function () {\n    return appendMutableCookies;\n  },\n  getModifiedCookieValues: function () {\n    return getModifiedCookieValues;\n  }\n});\nconst _cookies = require(\"../cookies\");\nconst _reflect = require(\"./reflect\");\nconst _staticgenerationasyncstorageexternal = require(\"../../../../client/components/static-generation-async-storage.external\");\nclass ReadonlyRequestCookiesError extends Error {\n  constructor() {\n    super(\"Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options\");\n  }\n  static callable() {\n    throw new ReadonlyRequestCookiesError();\n  }\n}\nclass RequestCookiesAdapter {\n  static seal(cookies) {\n    return new Proxy(cookies, {\n      get(target, prop, receiver) {\n        switch (prop) {\n          case \"clear\":\n          case \"delete\":\n          case \"set\":\n            return ReadonlyRequestCookiesError.callable;\n          default:\n            return _reflect.ReflectAdapter.get(target, prop, receiver);\n        }\n      }\n    });\n  }\n}\nconst SYMBOL_MODIFY_COOKIE_VALUES = Symbol.for(\"next.mutated.cookies\");\nfunction getModifiedCookieValues(cookies) {\n  const modified = cookies[SYMBOL_MODIFY_COOKIE_VALUES];\n  if (!modified || !Array.isArray(modified) || modified.length === 0) {\n    return [];\n  }\n  return modified;\n}\nfunction appendMutableCookies(headers, mutableCookies) {\n  const modifiedCookieValues = getModifiedCookieValues(mutableCookies);\n  if (modifiedCookieValues.length === 0) {\n    return false;\n  }\n  // Return a new response that extends the response with\n  // the modified cookies as fallbacks. `res` cookies\n  // will still take precedence.\n  const resCookies = new _cookies.ResponseCookies(headers);\n  const returnedCookies = resCookies.getAll();\n  // Set the modified cookies as fallbacks.\n  for (const cookie of modifiedCookieValues) {\n    resCookies.set(cookie);\n  }\n  // Set the original cookies as the final values.\n  for (const cookie of returnedCookies) {\n    resCookies.set(cookie);\n  }\n  return true;\n}\nclass MutableRequestCookiesAdapter {\n  static wrap(cookies, onUpdateCookies) {\n    const responseCookies = new _cookies.ResponseCookies(new Headers());\n    for (const cookie of cookies.getAll()) {\n      responseCookies.set(cookie);\n    }\n    let modifiedValues = [];\n    const modifiedCookies = new Set();\n    const updateResponseCookies = () => {\n      // TODO-APP: change method of getting staticGenerationAsyncStore\n      const staticGenerationAsyncStore = _staticgenerationasyncstorageexternal.staticGenerationAsyncStorage.getStore();\n      if (staticGenerationAsyncStore) {\n        staticGenerationAsyncStore.pathWasRevalidated = true;\n      }\n      const allCookies = responseCookies.getAll();\n      modifiedValues = allCookies.filter(c => modifiedCookies.has(c.name));\n      if (onUpdateCookies) {\n        const serializedCookies = [];\n        for (const cookie of modifiedValues) {\n          const tempCookies = new _cookies.ResponseCookies(new Headers());\n          tempCookies.set(cookie);\n          serializedCookies.push(tempCookies.toString());\n        }\n        onUpdateCookies(serializedCookies);\n      }\n    };\n    return new Proxy(responseCookies, {\n      get(target, prop, receiver) {\n        switch (prop) {\n          // A special symbol to get the modified cookie values\n          case SYMBOL_MODIFY_COOKIE_VALUES:\n            return modifiedValues;\n          // TODO: Throw error if trying to set a cookie after the response\n          // headers have been set.\n          case \"delete\":\n            return function () {\n              for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n                args[_key] = arguments[_key];\n              }\n              modifiedCookies.add(typeof args[0] === \"string\" ? args[0] : args[0].name);\n              try {\n                target.delete(...args);\n              } finally {\n                updateResponseCookies();\n              }\n            };\n          case \"set\":\n            return function () {\n              for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                args[_key2] = arguments[_key2];\n              }\n              modifiedCookies.add(typeof args[0] === \"string\" ? args[0] : args[0].name);\n              try {\n                return target.set(...args);\n              } finally {\n                updateResponseCookies();\n              }\n            };\n          default:\n            return _reflect.ReflectAdapter.get(target, prop, receiver);\n        }\n      }\n    });\n  }\n}","map":{"version":3,"names":["MutableRequestCookiesAdapter","ReadonlyRequestCookiesError","RequestCookiesAdapter","appendMutableCookies","getModifiedCookieValues","Error","constructor","callable","seal","cookies","Proxy","get","target","prop","receiver","_reflect","ReflectAdapter","SYMBOL_MODIFY_COOKIE_VALUES","Symbol","for","modified","Array","isArray","length","headers","mutableCookies","modifiedCookieValues","resCookies","_cookies","ResponseCookies","returnedCookies","getAll","cookie","set","wrap","onUpdateCookies","responseCookies","Headers","modifiedValues","modifiedCookies","Set","updateResponseCookies","staticGenerationAsyncStore","_staticgenerationasyncstorageexternal","staticGenerationAsyncStorage","getStore","pathWasRevalidated","allCookies","filter","c","has","name","serializedCookies","tempCookies","push","toString","_len","arguments","args","_key","add","delete","_len2","_key2"],"sources":["../../../../../src/server/web/spec-extension/adapters/request-cookies.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;;EA8FaA,4BAA4B,WAAAA,CAAA;WAA5BA,4BAAA;;EArFAC,2BAA2B,WAAAA,CAAA;WAA3BA,2BAAA;;EAqBAC,qBAAqB,WAAAA,CAAA;WAArBA,qBAAA;;EAgCGC,oBAAoB,WAAAA,CAAA;WAApBA,oBAAA;;EAbAC,uBAAuB,WAAAA,CAAA;WAAvBA,uBAAA;;;yBA/CgB;yBACD;sDACc;AAKtC,MAAMH,2BAAA,SAAoCI,KAAA;EAC/CC,YAAA,EAAc;IACZ,KAAK,CACH;EAEJ;EAEA,OAAcC,SAAA,EAAW;IACvB,MAAM,IAAIN,2BAAA;EACZ;AACF;AAWO,MAAMC,qBAAA;EACX,OAAcM,KAAKC,OAAuB,EAA0B;IAClE,OAAO,IAAIC,KAAA,CAAMD,OAAA,EAAgB;MAC/BE,IAAIC,MAAM,EAAEC,IAAI,EAAEC,QAAQ;QACxB,QAAQD,IAAA;UACN,KAAK;UACL,KAAK;UACL,KAAK;YACH,OAAOZ,2BAAA,CAA4BM,QAAQ;UAC7C;YACE,OAAOQ,QAAA,CAAAC,cAAc,CAACL,GAAG,CAACC,MAAA,EAAQC,IAAA,EAAMC,QAAA;QAC5C;MACF;IACF;EACF;AACF;AAEA,MAAMG,2BAAA,GAA8BC,MAAA,CAAOC,GAAG,CAAC;AAExC,SAASf,wBACdK,OAAwB;EAExB,MAAMW,QAAA,GAAyCX,OAA2B,CACxEQ,2BAAA,CACD;EACD,IAAI,CAACG,QAAA,IAAY,CAACC,KAAA,CAAMC,OAAO,CAACF,QAAA,KAAaA,QAAA,CAASG,MAAM,KAAK,GAAG;IAClE,OAAO,EAAE;EACX;EAEA,OAAOH,QAAA;AACT;AAEO,SAASjB,qBACdqB,OAAgB,EAChBC,cAA+B;EAE/B,MAAMC,oBAAA,GAAuBtB,uBAAA,CAAwBqB,cAAA;EACrD,IAAIC,oBAAA,CAAqBH,MAAM,KAAK,GAAG;IACrC,OAAO;EACT;EAEA;EACA;EACA;EACA,MAAMI,UAAA,GAAa,IAAIC,QAAA,CAAAC,eAAe,CAACL,OAAA;EACvC,MAAMM,eAAA,GAAkBH,UAAA,CAAWI,MAAM;EAEzC;EACA,KAAK,MAAMC,MAAA,IAAUN,oBAAA,EAAsB;IACzCC,UAAA,CAAWM,GAAG,CAACD,MAAA;EACjB;EAEA;EACA,KAAK,MAAMA,MAAA,IAAUF,eAAA,EAAiB;IACpCH,UAAA,CAAWM,GAAG,CAACD,MAAA;EACjB;EAEA,OAAO;AACT;AAMO,MAAMhC,4BAAA;EACX,OAAckC,KACZzB,OAAuB,EACvB0B,eAA6C,EAC5B;IACjB,MAAMC,eAAA,GAAkB,IAAIR,QAAA,CAAAC,eAAe,CAAC,IAAIQ,OAAA;IAChD,KAAK,MAAML,MAAA,IAAUvB,OAAA,CAAQsB,MAAM,IAAI;MACrCK,eAAA,CAAgBH,GAAG,CAACD,MAAA;IACtB;IAEA,IAAIM,cAAA,GAAmC,EAAE;IACzC,MAAMC,eAAA,GAAkB,IAAIC,GAAA;IAC5B,MAAMC,qBAAA,GAAwBA,CAAA;MAC5B;MACA,MAAMC,0BAAA,GAA6BC,qCAAA,CAAAC,4BAA4B,CAACC,QAAQ;MACxE,IAAIH,0BAAA,EAA4B;QAC9BA,0BAAA,CAA2BI,kBAAkB,GAAG;MAClD;MAEA,MAAMC,UAAA,GAAaX,eAAA,CAAgBL,MAAM;MACzCO,cAAA,GAAiBS,UAAA,CAAWC,MAAM,CAAEC,CAAA,IAAMV,eAAA,CAAgBW,GAAG,CAACD,CAAA,CAAEE,IAAI;MACpE,IAAIhB,eAAA,EAAiB;QACnB,MAAMiB,iBAAA,GAA8B,EAAE;QACtC,KAAK,MAAMpB,MAAA,IAAUM,cAAA,EAAgB;UACnC,MAAMe,WAAA,GAAc,IAAIzB,QAAA,CAAAC,eAAe,CAAC,IAAIQ,OAAA;UAC5CgB,WAAA,CAAYpB,GAAG,CAACD,MAAA;UAChBoB,iBAAA,CAAkBE,IAAI,CAACD,WAAA,CAAYE,QAAQ;QAC7C;QAEApB,eAAA,CAAgBiB,iBAAA;MAClB;IACF;IAEA,OAAO,IAAI1C,KAAA,CAAM0B,eAAA,EAAiB;MAChCzB,IAAIC,MAAM,EAAEC,IAAI,EAAEC,QAAQ;QACxB,QAAQD,IAAA;UACN;UACA,KAAKI,2BAAA;YACH,OAAOqB,cAAA;UAET;UACA;UACA,KAAK;YACH,OAAO,YAA8C;cAAA,SAAAkB,IAAA,GAAAC,SAAA,CAAAlC,MAAA,EAAjCmC,IAAiC,OAAArC,KAAA,CAAAmC,IAAA,GAAAG,IAAA,MAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA;gBAAjCD,IAAiC,CAAAC,IAAA,IAAAF,SAAA,CAAAE,IAAA;cAAA;cACnDpB,eAAA,CAAgBqB,GAAG,CACjB,OAAOF,IAAI,CAAC,EAAE,KAAK,WAAWA,IAAI,CAAC,EAAE,GAAGA,IAAI,CAAC,EAAE,CAACP,IAAI;cAEtD,IAAI;gBACFvC,MAAA,CAAOiD,MAAM,IAAIH,IAAA;cACnB,UAAU;gBACRjB,qBAAA;cACF;YACF;UACF,KAAK;YACH,OAAO,YAGwB;cAAA,SAAAqB,KAAA,GAAAL,SAAA,CAAAlC,MAAA,EAF1BmC,IAE0B,OAAArC,KAAA,CAAAyC,KAAA,GAAAC,KAAA,MAAAA,KAAA,GAAAD,KAAA,EAAAC,KAAA;gBAF1BL,IAE0B,CAAAK,KAAA,IAAAN,SAAA,CAAAM,KAAA;cAAA;cAE7BxB,eAAA,CAAgBqB,GAAG,CACjB,OAAOF,IAAI,CAAC,EAAE,KAAK,WAAWA,IAAI,CAAC,EAAE,GAAGA,IAAI,CAAC,EAAE,CAACP,IAAI;cAEtD,IAAI;gBACF,OAAOvC,MAAA,CAAOqB,GAAG,IAAIyB,IAAA;cACvB,UAAU;gBACRjB,qBAAA;cACF;YACF;UACF;YACE,OAAO1B,QAAA,CAAAC,cAAc,CAACL,GAAG,CAACC,MAAA,EAAQC,IAAA,EAAMC,QAAA;QAC5C;MACF;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}